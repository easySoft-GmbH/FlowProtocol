@page "{template}"
@model FlowProtocol.Pages.FlowTemplates.ApplyModel

@{
    ViewData["Title"] = "FlowProtocol Vorlage";
}

@if (Model.ShowRestrictions.Any())
{
    <form method="post">
        <h2>Vorlage @Model.TemplateBreadcrumb</h2>
        @if(Model.TemplateDescription != null)
        {
            <p> 
            @foreach(var line in Model.TemplateDescription)
            {
                @line<br>
            }
            </p><hr>            
        }
        @foreach (var k in Model.GivenKeys)
        {
            <input type="hidden" asp-for="SelectedOptions[k]" />
        }
        @foreach (var r in Model.ShowRestrictions)
        {
            <div class="formbuilder-radio-group form-group">
                <label class="formbuilder-radio-group-label">
                    @r.QuestionText
                    <br>
                    @if (!string.IsNullOrEmpty(r.HelpText))
                    {
                        <span class="tooltip-element" tooltip="@r.HelpText">?</span>
                    }
                </label>
                <div class="radio-group">
                    @foreach (var idx in r.Options)
                    {
                        <div class="formbuilder-radio">
                            <input value="@idx.Key" type="radio" asp-for="SelectedOptions[r.Key]">
                            <label>@idx.OptionText</label>
                        </div>
                    }
                </div>
            </div><br>
        }
        <button type="submit" class="btn btn-primary">Weiter</button>
    </form>
}
else
{
    <h2>Ergebnisliste (@Model.TemplateBreadcrumb)</h2>
    @foreach(var group in Model.ShowResultGroups)
    {
        @if (!string.IsNullOrWhiteSpace(group.Key))
        {
            <h4>@group.Key</h4>
        }
        else if (Model.ShowResultGroups.Count > 1)
        {
            <h4>Allgemein</h4>
        }
        <ol>
            @foreach (var t in group.Value)
            {
                <li>
                    @t.ResultItemText
                    @if (t.SubItems.Any())
                    {
                        <ul>
                            @foreach(var s in t.SubItems)
                            {
                                <li>
                                @if(Model.IsURL(s))
                                {
                                    <a href="@s" target="_blank">@s</a>
                                }
                                else
                                {
                                    @s
                                }
                                </li>
                            }
                        </ul>
                    }
                </li>
            }
        </ol>
    }
    <p><a asp-page="/Index" class="btn btn-primary">Zurück zur Startseite</a></p>
}